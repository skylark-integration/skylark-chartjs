/**
 * skylark-chartjs - A version of chartjs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.2
 * @link https://github.com/skylarkui/skylark-chartjs/
 * @license MIT
 */
define(["../core/core.datasetController","../core/core.defaults","../elements/index","../helpers/index"],function(e,t,o,r){"use strict";var i={},n={exports:{}},a=e,s=t,d=o,l=r,u=l.valueOrDefault,p=l.options.resolve,c=l.canvas._isPointInArea;function h(e,t){return u(e.showLine,t.showLines)}function v(e){return"object"!=typeof e||Array.isArray(e)||!function(e){var t;for(t in e)return!1;return!0}(e)}return s._set("line",{showLines:!0,spanGaps:!1,hover:{mode:"label"},scales:{xAxes:[{type:"category",id:"x-axis-0"}],yAxes:[{type:"linear",id:"y-axis-0"}]}}),n.exports=a.extend({datasetElementType:d.Line,dataElementType:d.Point,update:function(e){var t,o,r=this,i=r.getMeta(),n=i.dataset,a=i.data||[],s=r.getScaleForId(i.yAxisID),d=r.getDataset(),l=h(d,r.chart.options);for(l&&(void 0!==d.tension&&void 0===d.lineTension&&(d.lineTension=d.tension),n._scale=s,n._datasetIndex=r.index,n._children=a,n._model=r._resolveLineOptions(n),n.pivot()),t=0,o=a.length;t<o;++t)r.updateElement(a[t],t,e);for(l&&0!==n._model.tension&&r.updateBezierControlPoints(),t=0,o=a.length;t<o;++t)a[t].pivot()},updateElement:function(e,t,o){var r,i,n=this,a=n.getMeta(),s=e.custom||{},d=n.getDataset(),l=n.index,p=d.data[t],c=n.getScaleForId(a.yAxisID),h=n.getScaleForId(a.xAxisID),v=a.dataset._model,x=n._resolvePointOptions(e,t);r=h.getPixelForValue("object"==typeof p?p:NaN,t,l),i=o?c.getBasePixel():n.calculatePointY(p,t,l),e._xScale=h,e._yScale=c,e._options=x,e._datasetIndex=l,e._index=t,e._model={x:r,y:i,skip:s.skip||isNaN(r)||isNaN(i),radius:x.radius,pointStyle:x.pointStyle,rotation:x.rotation,backgroundColor:x.backgroundColor,borderColor:x.borderColor,borderWidth:x.borderWidth,tension:u(s.tension,v?v.tension:0),steppedLine:!!v&&v.steppedLine,hitRadius:x.hitRadius}},_resolvePointOptions:function(e,t){var o,r,i,n=this.chart,a=n.data.datasets[this.index],s=e.custom||{},d=n.options.elements.point,l={},u={chart:n,dataIndex:t,dataset:a,datasetIndex:this.index},c={backgroundColor:"pointBackgroundColor",borderColor:"pointBorderColor",borderWidth:"pointBorderWidth",hitRadius:"pointHitRadius",hoverBackgroundColor:"pointHoverBackgroundColor",hoverBorderColor:"pointHoverBorderColor",hoverBorderWidth:"pointHoverBorderWidth",hoverRadius:"pointHoverRadius",pointStyle:"pointStyle",radius:"pointRadius",rotation:"pointRotation"},h=Object.keys(c);for(o=0,r=h.length;o<r;++o)l[i=h[o]]=p([s[i],a[c[i]],a[i],d[i]],u,t);return l},_resolveLineOptions:function(e){var t,o,r,i=this.chart,n=i.data.datasets[this.index],a=e.custom||{},s=i.options,d=s.elements.line,l={},c=["backgroundColor","borderWidth","borderColor","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","fill","cubicInterpolationMode"];for(t=0,o=c.length;t<o;++t)l[r=c[t]]=p([a[r],n[r],d[r]]);return l.spanGaps=u(n.spanGaps,s.spanGaps),l.tension=u(n.lineTension,d.tension),l.steppedLine=p([a.steppedLine,n.steppedLine,d.stepped]),l},calculatePointY:function(e,t,o){var r,i,n,a=this.chart,s=this.getMeta(),d=this.getScaleForId(s.yAxisID),l=0,u=0;if(d.options.stacked){for(r=0;r<o;r++)if(i=a.data.datasets[r],"line"===(n=a.getDatasetMeta(r)).type&&n.yAxisID===d.id&&a.isDatasetVisible(r)){var p=Number(d.getRightValue(i.data[t]));p<0?u+=p||0:l+=p||0}var c=Number(d.getRightValue(e));return c<0?d.getPixelForValue(u+c):d.getPixelForValue(l+c)}return d.getPixelForValue(e)},updateBezierControlPoints:function(){var e,t,o,r,i=this.chart,n=this.getMeta(),a=n.dataset._model,s=i.chartArea,d=n.data||[];function u(e,t,o){return Math.max(Math.min(e,o),t)}if(a.spanGaps&&(d=d.filter(function(e){return!e._model.skip})),"monotone"===a.cubicInterpolationMode)l.splineCurveMonotone(d);else for(e=0,t=d.length;e<t;++e)o=d[e]._model,r=l.splineCurve(l.previousItem(d,e)._model,o,l.nextItem(d,e)._model,a.tension),o.controlPointPreviousX=r.previous.x,o.controlPointPreviousY=r.previous.y,o.controlPointNextX=r.next.x,o.controlPointNextY=r.next.y;if(i.options.elements.line.capBezierPoints)for(e=0,t=d.length;e<t;++e)o=d[e]._model,c(o,s)&&(e>0&&c(d[e-1]._model,s)&&(o.controlPointPreviousX=u(o.controlPointPreviousX,s.left,s.right),o.controlPointPreviousY=u(o.controlPointPreviousY,s.top,s.bottom)),e<d.length-1&&c(d[e+1]._model,s)&&(o.controlPointNextX=u(o.controlPointNextX,s.left,s.right),o.controlPointNextY=u(o.controlPointNextY,s.top,s.bottom)))},draw:function(){var e,t=this.chart,o=this.getMeta(),r=o.data||[],i=t.chartArea,n=r.length,a=0;for(h(this.getDataset(),t.options)&&(e=(o.dataset._model.borderWidth||0)/2,l.canvas.clipArea(t.ctx,{left:i.left,right:i.right,top:i.top-e,bottom:i.bottom+e}),o.dataset.draw(),l.canvas.unclipArea(t.ctx));a<n;++a)r[a].draw(i)},setHoverStyle:function(e){var t=e._model,o=e._options,r=l.getHoverColor;e.$previousStyle={backgroundColor:t.backgroundColor,borderColor:t.borderColor,borderWidth:t.borderWidth,radius:t.radius},t.backgroundColor=u(o.hoverBackgroundColor,r(o.backgroundColor)),t.borderColor=u(o.hoverBorderColor,r(o.borderColor)),t.borderWidth=u(o.hoverBorderWidth,o.borderWidth),t.radius=u(o.hoverRadius,o.radius)}}),v(n.exports)?n.exports:v(i)?i:void 0});
//# sourceMappingURL=../sourcemaps/controllers/controller.line.js.map
