/**
 * skylark-chartjs - A version of chartjs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.2
 * @link https://github.com/skylark-integration/skylark-chartjs/
 * @license MIT
 */
define(["../core/core.datasetController","../core/core.defaults","../elements/index","../helpers/index"],function(e,t,a,r){"use strict";var i={},n={exports:{}},s=e,o=t,l=a,c=r,d=c.options.resolve;function h(e){return"object"!=typeof e||Array.isArray(e)||!function(e){var t;for(t in e)return!1;return!0}(e)}return o._set("bar",{hover:{mode:"label"},scales:{xAxes:[{type:"category",categoryPercentage:.8,barPercentage:.9,offset:!0,gridLines:{offsetGridLines:!0}}],yAxes:[{type:"linear"}]}}),n.exports=s.extend({dataElementType:l.Rectangle,initialize:function(){var e;s.prototype.initialize.apply(this,arguments),(e=this.getMeta()).stack=this.getDataset().stack,e.bar=!0},update:function(e){var t,a,r=this.getMeta().data;for(this._ruler=this.getRuler(),t=0,a=r.length;t<a;++t)this.updateElement(r[t],t,e)},updateElement:function(e,t,a){var r=this,i=r.getMeta(),n=r.getDataset(),s=r._resolveElementOptions(e,t);e._xScale=r.getScaleForId(i.xAxisID),e._yScale=r.getScaleForId(i.yAxisID),e._datasetIndex=r.index,e._index=t,e._model={backgroundColor:s.backgroundColor,borderColor:s.borderColor,borderSkipped:s.borderSkipped,borderWidth:s.borderWidth,datasetLabel:n.label,label:r.chart.data.labels[t]},r._updateElementGeometry(e,t,a),e.pivot()},_updateElementGeometry:function(e,t,a){var r=this,i=e._model,n=r._getValueScale(),s=n.getBasePixel(),o=n.isHorizontal(),l=r._ruler||r.getRuler(),c=r.calculateBarValuePixels(r.index,t),d=r.calculateBarIndexPixels(r.index,t,l);i.horizontal=o,i.base=a?s:c.base,i.x=o?a?s:c.head:d.center,i.y=o?d.center:a?s:c.head,i.height=o?d.size:void 0,i.width=o?void 0:d.size},_getStacks:function(e){var t,a,r=this.chart,i=this._getIndexScale().options.stacked,n=void 0===e?r.data.datasets.length:e+1,s=[];for(t=0;t<n;++t)(a=r.getDatasetMeta(t)).bar&&r.isDatasetVisible(t)&&(!1===i||!0===i&&-1===s.indexOf(a.stack)||void 0===i&&(void 0===a.stack||-1===s.indexOf(a.stack)))&&s.push(a.stack);return s},getStackCount:function(){return this._getStacks().length},getStackIndex:function(e,t){var a=this._getStacks(e),r=void 0!==t?a.indexOf(t):-1;return-1===r?a.length-1:r},getRuler:function(){var e,t,a=this._getIndexScale(),r=this.getStackCount(),i=this.index,n=a.isHorizontal(),s=n?a.left:a.top,o=s+(n?a.width:a.height),l=[];for(e=0,t=this.getMeta().data.length;e<t;++e)l.push(a.getPixelForValue(null,e,i));return{min:c.isNullOrUndef(a.options.barThickness)?function(e,t){var a,r,i,n,s=e.isHorizontal()?e.width:e.height,o=e.getTicks();for(i=1,n=t.length;i<n;++i)s=Math.min(s,Math.abs(t[i]-t[i-1]));for(i=0,n=o.length;i<n;++i)r=e.getPixelForTick(i),s=i>0?Math.min(s,r-a):s,a=r;return s}(a,l):-1,pixels:l,start:s,end:o,stackCount:r,scale:a}},calculateBarValuePixels:function(e,t){var a,r,i,n,s,o,l=this.chart,c=this.getMeta(),d=this._getValueScale(),h=d.isHorizontal(),u=l.data.datasets,g=+d.getRightValue(u[e].data[t]),x=d.options.minBarLength,f=d.options.stacked,p=c.stack,k=0;if(f||void 0===f&&void 0!==p)for(a=0;a<e;++a)(r=l.getDatasetMeta(a)).bar&&r.stack===p&&r.controller._getValueScaleId()===d.id&&l.isDatasetVisible(a)&&(i=+d.getRightValue(u[a].data[t]),(g<0&&i<0||g>=0&&i>0)&&(k+=i));return n=d.getPixelForValue(k),o=(s=d.getPixelForValue(k+g))-n,void 0!==x&&Math.abs(o)<x&&(o=x,s=g>=0&&!h||g<0&&h?n-x:n+x),{size:o,base:n,head:s,center:s+o/2}},calculateBarIndexPixels:function(e,t,a){var r=a.scale.options,i="flex"===r.barThickness?function(e,t,a){var r,i=t.pixels,n=i[e],s=e>0?i[e-1]:null,o=e<i.length-1?i[e+1]:null,l=a.categoryPercentage;return null===s&&(s=n-(null===o?t.end-t.start:o-n)),null===o&&(o=n+n-s),r=n-(n-Math.min(s,o))/2*l,{chunk:Math.abs(o-s)/2*l/t.stackCount,ratio:a.barPercentage,start:r}}(t,a,r):function(e,t,a){var r,i,n=a.barThickness,s=t.stackCount,o=t.pixels[e];return c.isNullOrUndef(n)?(r=t.min*a.categoryPercentage,i=a.barPercentage):(r=n*s,i=1),{chunk:r/s,ratio:i,start:o-r/2}}(t,a,r),n=this.getStackIndex(e,this.getMeta().stack),s=i.start+i.chunk*n+i.chunk/2,o=Math.min(c.valueOrDefault(r.maxBarThickness,1/0),i.chunk*i.ratio);return{base:s-o/2,head:s+o/2,center:s,size:o}},draw:function(){var e=this.chart,t=this._getValueScale(),a=this.getMeta().data,r=this.getDataset(),i=a.length,n=0;for(c.canvas.clipArea(e.ctx,e.chartArea);n<i;++n)isNaN(t.getRightValue(r.data[n]))||a[n].draw();c.canvas.unclipArea(e.ctx)},_resolveElementOptions:function(e,t){var a,r,i,n=this.chart,s=n.data.datasets[this.index],o=e.custom||{},l=n.options.elements.rectangle,c={},h={chart:n,dataIndex:t,dataset:s,datasetIndex:this.index},u=["backgroundColor","borderColor","borderSkipped","borderWidth"];for(a=0,r=u.length;a<r;++a)c[i=u[a]]=d([o[i],s[i],l[i]],h,t);return c}}),h(n.exports)?n.exports:h(i)?i:void 0});
//# sourceMappingURL=../sourcemaps/controllers/controller.bar.js.map
