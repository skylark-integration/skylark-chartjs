/**
 * skylark-chartjs - A version of chartjs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.2
 * @link https://github.com/skylark-integration/skylark-chartjs/
 * @license MIT
 */
define(["./core.defaults","./core.element","../helpers/index","./core.ticks"],function(t,i,e,o){"use strict";var a={},n={exports:{}},r=t,s=i,l=e,h=o,f=l.valueOrDefault,d=l.valueAtIndexOrDefault;function g(t){var i,e,o=[];for(i=0,e=t.length;i<e;++i)o.push(t[i].label);return o}function c(t,i,e){return l.isArray(i)?l.longestText(t,e,i):t.measureText(i).width}function p(t){return"object"!=typeof t||Array.isArray(t)||!function(t){var i;for(i in t)return!1;return!0}(t)}return r._set("scale",{display:!0,position:"left",offset:!1,gridLines:{display:!0,color:"rgba(0, 0, 0, 0.1)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickMarkLength:10,zeroLineWidth:1,zeroLineColor:"rgba(0,0,0,0.25)",zeroLineBorderDash:[],zeroLineBorderDashOffset:0,offsetGridLines:!1,borderDash:[],borderDashOffset:0},scaleLabel:{display:!1,labelString:"",padding:{top:4,bottom:4}},ticks:{beginAtZero:!1,minRotation:0,maxRotation:50,mirror:!1,padding:0,reverse:!1,display:!0,autoSkip:!0,autoSkipPadding:0,labelOffset:0,callback:h.formatters.values,minor:{},major:{}}}),n.exports=s.extend({getPadding:function(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}},getTicks:function(){return this._ticks},mergeTicksOptions:function(){var t=this.options.ticks;for(var i in!1===t.minor&&(t.minor={display:!1}),!1===t.major&&(t.major={display:!1}),t)"major"!==i&&"minor"!==i&&(void 0===t.minor[i]&&(t.minor[i]=t[i]),void 0===t.major[i]&&(t.major[i]=t[i]))},beforeUpdate:function(){l.callback(this.options.beforeUpdate,[this])},update:function(t,i,e){var o,a,n,r,s,h,f=this;for(f.beforeUpdate(),f.maxWidth=t,f.maxHeight=i,f.margins=l.extend({left:0,right:0,top:0,bottom:0},e),f._maxLabelLines=0,f.longestLabelWidth=0,f.longestTextCache=f.longestTextCache||{},f.beforeSetDimensions(),f.setDimensions(),f.afterSetDimensions(),f.beforeDataLimits(),f.determineDataLimits(),f.afterDataLimits(),f.beforeBuildTicks(),s=f.buildTicks()||[],s=f.afterBuildTicks(s)||s,f.beforeTickToLabelConversion(),n=f.convertTicksToLabels(s)||f.ticks,f.afterTickToLabelConversion(),f.ticks=n,o=0,a=n.length;o<a;++o)r=n[o],(h=s[o])?h.label=r:s.push(h={label:r,major:!1});return f._ticks=s,f.beforeCalculateTickRotation(),f.calculateTickRotation(),f.afterCalculateTickRotation(),f.beforeFit(),f.fit(),f.afterFit(),f.afterUpdate(),f.minSize},afterUpdate:function(){l.callback(this.options.afterUpdate,[this])},beforeSetDimensions:function(){l.callback(this.options.beforeSetDimensions,[this])},setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0},afterSetDimensions:function(){l.callback(this.options.afterSetDimensions,[this])},beforeDataLimits:function(){l.callback(this.options.beforeDataLimits,[this])},determineDataLimits:l.noop,afterDataLimits:function(){l.callback(this.options.afterDataLimits,[this])},beforeBuildTicks:function(){l.callback(this.options.beforeBuildTicks,[this])},buildTicks:l.noop,afterBuildTicks:function(t){var i=this;return l.isArray(t)&&t.length?l.callback(i.options.afterBuildTicks,[i,t]):(i.ticks=l.callback(i.options.afterBuildTicks,[i,i.ticks])||i.ticks,t)},beforeTickToLabelConversion:function(){l.callback(this.options.beforeTickToLabelConversion,[this])},convertTicksToLabels:function(){var t=this.options.ticks;this.ticks=this.ticks.map(t.userCallback||t.callback,this)},afterTickToLabelConversion:function(){l.callback(this.options.afterTickToLabelConversion,[this])},beforeCalculateTickRotation:function(){l.callback(this.options.beforeCalculateTickRotation,[this])},calculateTickRotation:function(){var t=this,i=t.ctx,e=t.options.ticks,o=g(t._ticks),a=l.options._parseFont(e);i.font=a.string;var n=e.minRotation||0;if(o.length&&t.options.display&&t.isHorizontal())for(var r,s=l.longestText(i,a.string,o,t.longestTextCache),h=s,f=t.getPixelForTick(1)-t.getPixelForTick(0)-6;h>f&&n<e.maxRotation;){var d=l.toRadians(n);if(r=Math.cos(d),Math.sin(d)*s>t.maxHeight){n--;break}n++,h=r*s}t.labelRotation=n},afterCalculateTickRotation:function(){l.callback(this.options.afterCalculateTickRotation,[this])},beforeFit:function(){l.callback(this.options.beforeFit,[this])},fit:function(){var t=this,i=t.minSize={width:0,height:0},e=g(t._ticks),o=t.options,a=o.ticks,n=o.scaleLabel,r=o.gridLines,s=t._isVisible(),h=o.position,f=t.isHorizontal(),d=l.options._parseFont,p=d(a),m=o.gridLines.tickMarkLength;if(i.width=f?t.isFullWidth()?t.maxWidth-t.margins.left-t.margins.right:t.maxWidth:s&&r.drawTicks?m:0,i.height=f?s&&r.drawTicks?m:0:t.maxHeight,n.display&&s){var u=d(n),b=l.options.toPadding(n.padding),k=u.lineHeight+b.height;f?i.height+=k:i.width+=k}if(a.display&&s){var x=l.longestText(t.ctx,p.string,e,t.longestTextCache),T=l.numberOfLabelLines(e),v=.5*p.size,L=t.options.ticks.padding;if(t._maxLabelLines=T,t.longestLabelWidth=x,f){var D=l.toRadians(t.labelRotation),y=Math.cos(D),R=Math.sin(D)*x+p.lineHeight*T+v;i.height=Math.min(t.maxHeight,i.height+R+L),t.ctx.font=p.string;var F,M,B=c(t.ctx,e[0],p.string),z=c(t.ctx,e[e.length-1],p.string),C=t.getPixelForTick(0)-t.left,P=t.right-t.getPixelForTick(e.length-1);0!==t.labelRotation?(F="bottom"===h?y*B:y*v,M="bottom"===h?y*v:y*z):(F=B/2,M=z/2),t.paddingLeft=Math.max(F-C,0)+3,t.paddingRight=Math.max(M-P,0)+3}else a.mirror?x=0:x+=L+v,i.width=Math.min(t.maxWidth,i.width+x),t.paddingTop=p.size/2,t.paddingBottom=p.size/2}t.handleMargins(),t.width=i.width,t.height=i.height},handleMargins:function(){var t=this;t.margins&&(t.paddingLeft=Math.max(t.paddingLeft-t.margins.left,0),t.paddingTop=Math.max(t.paddingTop-t.margins.top,0),t.paddingRight=Math.max(t.paddingRight-t.margins.right,0),t.paddingBottom=Math.max(t.paddingBottom-t.margins.bottom,0))},afterFit:function(){l.callback(this.options.afterFit,[this])},isHorizontal:function(){return"top"===this.options.position||"bottom"===this.options.position},isFullWidth:function(){return this.options.fullWidth},getRightValue:function(t){if(l.isNullOrUndef(t))return NaN;if(("number"==typeof t||t instanceof Number)&&!isFinite(t))return NaN;if(t)if(this.isHorizontal()){if(void 0!==t.x)return this.getRightValue(t.x)}else if(void 0!==t.y)return this.getRightValue(t.y);return t},getLabelForIndex:l.noop,getPixelForValue:l.noop,getValueForPixel:l.noop,getPixelForTick:function(t){var i=this,e=i.options.offset;if(i.isHorizontal()){var o=(i.width-(i.paddingLeft+i.paddingRight))/Math.max(i._ticks.length-(e?0:1),1),a=o*t+i.paddingLeft;e&&(a+=o/2);var n=i.left+a;return n+=i.isFullWidth()?i.margins.left:0}var r=i.height-(i.paddingTop+i.paddingBottom);return i.top+t*(r/(i._ticks.length-1))},getPixelForDecimal:function(t){var i=this;if(i.isHorizontal()){var e=(i.width-(i.paddingLeft+i.paddingRight))*t+i.paddingLeft,o=i.left+e;return o+=i.isFullWidth()?i.margins.left:0}return i.top+t*i.height},getBasePixel:function(){return this.getPixelForValue(this.getBaseValue())},getBaseValue:function(){var t=this.min,i=this.max;return this.beginAtZero?0:t<0&&i<0?i:t>0&&i>0?t:0},_autoSkip:function(t){var i,e,o=this,a=o.isHorizontal(),n=o.options.ticks.minor,r=t.length,s=!1,l=n.maxTicksLimit,h=o._tickSize()*(r-1),f=a?o.width-(o.paddingLeft+o.paddingRight):o.height-(o.paddingTop+o.PaddingBottom),d=[];for(h>f&&(s=1+Math.floor(h/f)),r>l&&(s=Math.max(s,1+Math.floor(r/l))),i=0;i<r;i++)e=t[i],s>1&&i%s>0&&delete e.label,d.push(e);return d},_tickSize:function(){var t=this,i=t.isHorizontal(),e=t.options.ticks.minor,o=l.toRadians(t.labelRotation),a=Math.abs(Math.cos(o)),n=Math.abs(Math.sin(o)),r=e.autoSkipPadding||0,s=t.longestLabelWidth+r||0,h=l.options._parseFont(e),f=t._maxLabelLines*h.lineHeight+r||0;return i?f*a>s*n?s/a:f/n:f*n<s*a?f/a:s/n},_isVisible:function(){var t,i,e,o=this.chart,a=this.options.display;if("auto"!==a)return!!a;for(t=0,i=o.data.datasets.length;t<i;++t)if(o.isDatasetVisible(t)&&((e=o.getDatasetMeta(t)).xAxisID===this.id||e.yAxisID===this.id))return!0;return!1},draw:function(t){var i=this,e=i.options;if(i._isVisible()){var o,a,n,s=i.chart,h=i.ctx,g=r.global.defaultFontColor,c=e.ticks.minor,p=e.ticks.major||c,m=e.gridLines,u=e.scaleLabel,b=e.position,k=0!==i.labelRotation,x=c.mirror,T=i.isHorizontal(),v=l.options._parseFont,L=c.display&&c.autoSkip?i._autoSkip(i.getTicks()):i.getTicks(),D=f(c.fontColor,g),y=v(c),R=y.lineHeight,F=f(p.fontColor,g),M=v(p),B=c.padding,z=c.labelOffset,C=m.drawTicks?m.tickMarkLength:0,P=f(u.fontColor,g),w=v(u),W=l.options.toPadding(u.padding),S=l.toRadians(i.labelRotation),_=[],H=m.drawBorder?d(m.lineWidth,0,0):0,O=l._alignPixel;"top"===b?(o=O(s,i.bottom,H),a=i.bottom-C,n=o-H/2):"bottom"===b?(o=O(s,i.top,H),a=o+H/2,n=i.top+C):"left"===b?(o=O(s,i.right,H),a=i.right-C,n=o-H/2):(o=O(s,i.left,H),a=o+H/2,n=i.left+C);if(l.each(L,function(o,r){if(!l.isNullOrUndef(o.label)){var h,f,g,c,p,u,v,L,D,y,F,M,P,w,W,A,j=o.label;r===i.zeroLineIndex&&e.offset===m.offsetGridLines?(h=m.zeroLineWidth,f=m.zeroLineColor,g=m.zeroLineBorderDash||[],c=m.zeroLineBorderDashOffset||0):(h=d(m.lineWidth,r),f=d(m.color,r),g=m.borderDash||[],c=m.borderDashOffset||0);var V=l.isArray(j)?j.length:1,U=function(t,i,e){var o=t.getPixelForTick(i);return e&&(1===t.getTicks().length?o-=t.isHorizontal()?Math.max(o-t.left,t.right-o):Math.max(o-t.top,t.bottom-o):o-=0===i?(t.getPixelForTick(1)-o)/2:(o-t.getPixelForTick(i-1))/2),o}(i,r,m.offsetGridLines);if(T){var I=C+B;U<i.left-1e-7&&(f="rgba(0,0,0,0)"),p=v=D=F=O(s,U,h),u=a,L=n,P=i.getPixelForTick(r)+z,"top"===b?(y=O(s,t.top,H)+H/2,M=t.bottom,W=((k?1:.5)-V)*R,A=k?"left":"center",w=i.bottom-I):(y=t.top,M=O(s,t.bottom,H)-H/2,W=(k?0:.5)*R,A=k?"right":"center",w=i.top+I)}else{var N=(x?0:C)+B;U<i.top-1e-7&&(f="rgba(0,0,0,0)"),p=a,v=n,u=L=y=M=O(s,U,h),w=i.getPixelForTick(r)+z,W=(1-V)*R/2,"left"===b?(D=O(s,t.left,H)+H/2,F=t.right,A=x?"left":"right",P=i.right-N):(D=t.left,F=O(s,t.right,H)-H/2,A=x?"right":"left",P=i.left+N)}_.push({tx1:p,ty1:u,tx2:v,ty2:L,x1:D,y1:y,x2:F,y2:M,labelX:P,labelY:w,glWidth:h,glColor:f,glBorderDash:g,glBorderDashOffset:c,rotation:-1*S,label:j,major:o.major,textOffset:W,textAlign:A})}}),l.each(_,function(t){var i=t.glWidth,e=t.glColor;if(m.display&&i&&e&&(h.save(),h.lineWidth=i,h.strokeStyle=e,h.setLineDash&&(h.setLineDash(t.glBorderDash),h.lineDashOffset=t.glBorderDashOffset),h.beginPath(),m.drawTicks&&(h.moveTo(t.tx1,t.ty1),h.lineTo(t.tx2,t.ty2)),m.drawOnChartArea&&(h.moveTo(t.x1,t.y1),h.lineTo(t.x2,t.y2)),h.stroke(),h.restore()),c.display){h.save(),h.translate(t.labelX,t.labelY),h.rotate(t.rotation),h.font=t.major?M.string:y.string,h.fillStyle=t.major?F:D,h.textBaseline="middle",h.textAlign=t.textAlign;var o=t.label,a=t.textOffset;if(l.isArray(o))for(var n=0;n<o.length;++n)h.fillText(""+o[n],0,a),a+=R;else h.fillText(o,0,a);h.restore()}}),u.display){var A,j,V=0,U=w.lineHeight/2;if(T)A=i.left+(i.right-i.left)/2,j="bottom"===b?i.bottom-U-W.bottom:i.top+U+W.top;else{var I="left"===b;A=I?i.left+U+W.top:i.right-U-W.top,j=i.top+(i.bottom-i.top)/2,V=I?-.5*Math.PI:.5*Math.PI}h.save(),h.translate(A,j),h.rotate(V),h.textAlign="center",h.textBaseline="middle",h.fillStyle=P,h.font=w.string,h.fillText(u.labelString,0,0),h.restore()}if(H){var N,G,X,Y,Z=H,q=d(m.lineWidth,L.length-1,0);T?(N=O(s,i.left,Z)-Z/2,G=O(s,i.right,q)+q/2,X=Y=o):(X=O(s,i.top,Z)-Z/2,Y=O(s,i.bottom,q)+q/2,N=G=o),h.lineWidth=H,h.strokeStyle=d(m.color,0),h.beginPath(),h.moveTo(N,X),h.lineTo(G,Y),h.stroke()}}}}),p(n.exports)?n.exports:p(a)?a:void 0});
//# sourceMappingURL=../sourcemaps/core/core.scale.js.map
