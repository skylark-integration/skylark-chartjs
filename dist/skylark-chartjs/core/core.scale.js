/**
 * skylark-chartjs - A version of chartjs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.2
 * @link https://github.com/skylark-integration/skylark-chartjs/
 * @license MIT
 */
define(["./core.defaults","./core.element","../helpers/index","./core.ticks"],function(t,i,e,o){"use strict";var exports={},module={exports:{}},a=t,n=i,r=e,s=o,l=r.valueOrDefault,h=r.valueAtIndexOrDefault;function f(t){var i,e,o=[];for(i=0,e=t.length;i<e;++i)o.push(t[i].label);return o}function d(t,i,e){return r.isArray(i)?r.longestText(t,e,i):t.measureText(i).width}function g(t){return"object"!=typeof t||Array.isArray(t)||!function(t){var i;for(i in t)return!1;return!0}(t)}return a._set("scale",{display:!0,position:"left",offset:!1,gridLines:{display:!0,color:"rgba(0, 0, 0, 0.1)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickMarkLength:10,zeroLineWidth:1,zeroLineColor:"rgba(0,0,0,0.25)",zeroLineBorderDash:[],zeroLineBorderDashOffset:0,offsetGridLines:!1,borderDash:[],borderDashOffset:0},scaleLabel:{display:!1,labelString:"",padding:{top:4,bottom:4}},ticks:{beginAtZero:!1,minRotation:0,maxRotation:50,mirror:!1,padding:0,reverse:!1,display:!0,autoSkip:!0,autoSkipPadding:0,labelOffset:0,callback:s.formatters.values,minor:{},major:{}}}),module.exports=n.extend({getPadding:function(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}},getTicks:function(){return this._ticks},mergeTicksOptions:function(){var t=this.options.ticks;for(var i in!1===t.minor&&(t.minor={display:!1}),!1===t.major&&(t.major={display:!1}),t)"major"!==i&&"minor"!==i&&(void 0===t.minor[i]&&(t.minor[i]=t[i]),void 0===t.major[i]&&(t.major[i]=t[i]))},beforeUpdate:function(){r.callback(this.options.beforeUpdate,[this])},update:function(t,i,e){var o,a,n,s,l,h,f=this;for(f.beforeUpdate(),f.maxWidth=t,f.maxHeight=i,f.margins=r.extend({left:0,right:0,top:0,bottom:0},e),f._maxLabelLines=0,f.longestLabelWidth=0,f.longestTextCache=f.longestTextCache||{},f.beforeSetDimensions(),f.setDimensions(),f.afterSetDimensions(),f.beforeDataLimits(),f.determineDataLimits(),f.afterDataLimits(),f.beforeBuildTicks(),l=f.buildTicks()||[],l=f.afterBuildTicks(l)||l,f.beforeTickToLabelConversion(),n=f.convertTicksToLabels(l)||f.ticks,f.afterTickToLabelConversion(),f.ticks=n,o=0,a=n.length;o<a;++o)s=n[o],(h=l[o])?h.label=s:l.push(h={label:s,major:!1});return f._ticks=l,f.beforeCalculateTickRotation(),f.calculateTickRotation(),f.afterCalculateTickRotation(),f.beforeFit(),f.fit(),f.afterFit(),f.afterUpdate(),f.minSize},afterUpdate:function(){r.callback(this.options.afterUpdate,[this])},beforeSetDimensions:function(){r.callback(this.options.beforeSetDimensions,[this])},setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0},afterSetDimensions:function(){r.callback(this.options.afterSetDimensions,[this])},beforeDataLimits:function(){r.callback(this.options.beforeDataLimits,[this])},determineDataLimits:r.noop,afterDataLimits:function(){r.callback(this.options.afterDataLimits,[this])},beforeBuildTicks:function(){r.callback(this.options.beforeBuildTicks,[this])},buildTicks:r.noop,afterBuildTicks:function(t){var i=this;return r.isArray(t)&&t.length?r.callback(i.options.afterBuildTicks,[i,t]):(i.ticks=r.callback(i.options.afterBuildTicks,[i,i.ticks])||i.ticks,t)},beforeTickToLabelConversion:function(){r.callback(this.options.beforeTickToLabelConversion,[this])},convertTicksToLabels:function(){var t=this.options.ticks;this.ticks=this.ticks.map(t.userCallback||t.callback,this)},afterTickToLabelConversion:function(){r.callback(this.options.afterTickToLabelConversion,[this])},beforeCalculateTickRotation:function(){r.callback(this.options.beforeCalculateTickRotation,[this])},calculateTickRotation:function(){var t=this,i=t.ctx,e=t.options.ticks,o=f(t._ticks),a=r.options._parseFont(e);i.font=a.string;var n=e.minRotation||0;if(o.length&&t.options.display&&t.isHorizontal())for(var s,l=r.longestText(i,a.string,o,t.longestTextCache),h=l,d=t.getPixelForTick(1)-t.getPixelForTick(0)-6;h>d&&n<e.maxRotation;){var g=r.toRadians(n);if(s=Math.cos(g),Math.sin(g)*l>t.maxHeight){n--;break}n++,h=s*l}t.labelRotation=n},afterCalculateTickRotation:function(){r.callback(this.options.afterCalculateTickRotation,[this])},beforeFit:function(){r.callback(this.options.beforeFit,[this])},fit:function(){var t=this,i=t.minSize={width:0,height:0},e=f(t._ticks),o=t.options,a=o.ticks,n=o.scaleLabel,s=o.gridLines,l=t._isVisible(),h=o.position,g=t.isHorizontal(),c=r.options._parseFont,p=c(a),m=o.gridLines.tickMarkLength;if(i.width=g?t.isFullWidth()?t.maxWidth-t.margins.left-t.margins.right:t.maxWidth:l&&s.drawTicks?m:0,i.height=g?l&&s.drawTicks?m:0:t.maxHeight,n.display&&l){var u=c(n),b=r.options.toPadding(n.padding),k=u.lineHeight+b.height;g?i.height+=k:i.width+=k}if(a.display&&l){var x=r.longestText(t.ctx,p.string,e,t.longestTextCache),T=r.numberOfLabelLines(e),v=.5*p.size,L=t.options.ticks.padding;if(t._maxLabelLines=T,t.longestLabelWidth=x,g){var D=r.toRadians(t.labelRotation),y=Math.cos(D),R=Math.sin(D)*x+p.lineHeight*T+v;i.height=Math.min(t.maxHeight,i.height+R+L),t.ctx.font=p.string;var F,M,B=d(t.ctx,e[0],p.string),z=d(t.ctx,e[e.length-1],p.string),C=t.getPixelForTick(0)-t.left,P=t.right-t.getPixelForTick(e.length-1);0!==t.labelRotation?(F="bottom"===h?y*B:y*v,M="bottom"===h?y*v:y*z):(F=B/2,M=z/2),t.paddingLeft=Math.max(F-C,0)+3,t.paddingRight=Math.max(M-P,0)+3}else a.mirror?x=0:x+=L+v,i.width=Math.min(t.maxWidth,i.width+x),t.paddingTop=p.size/2,t.paddingBottom=p.size/2}t.handleMargins(),t.width=i.width,t.height=i.height},handleMargins:function(){var t=this;t.margins&&(t.paddingLeft=Math.max(t.paddingLeft-t.margins.left,0),t.paddingTop=Math.max(t.paddingTop-t.margins.top,0),t.paddingRight=Math.max(t.paddingRight-t.margins.right,0),t.paddingBottom=Math.max(t.paddingBottom-t.margins.bottom,0))},afterFit:function(){r.callback(this.options.afterFit,[this])},isHorizontal:function(){return"top"===this.options.position||"bottom"===this.options.position},isFullWidth:function(){return this.options.fullWidth},getRightValue:function(t){if(r.isNullOrUndef(t))return NaN;if(("number"==typeof t||t instanceof Number)&&!isFinite(t))return NaN;if(t)if(this.isHorizontal()){if(void 0!==t.x)return this.getRightValue(t.x)}else if(void 0!==t.y)return this.getRightValue(t.y);return t},getLabelForIndex:r.noop,getPixelForValue:r.noop,getValueForPixel:r.noop,getPixelForTick:function(t){var i=this,e=i.options.offset;if(i.isHorizontal()){var o=(i.width-(i.paddingLeft+i.paddingRight))/Math.max(i._ticks.length-(e?0:1),1),a=o*t+i.paddingLeft;e&&(a+=o/2);var n=i.left+a;return n+=i.isFullWidth()?i.margins.left:0}var r=i.height-(i.paddingTop+i.paddingBottom);return i.top+t*(r/(i._ticks.length-1))},getPixelForDecimal:function(t){var i=this;if(i.isHorizontal()){var e=(i.width-(i.paddingLeft+i.paddingRight))*t+i.paddingLeft,o=i.left+e;return o+=i.isFullWidth()?i.margins.left:0}return i.top+t*i.height},getBasePixel:function(){return this.getPixelForValue(this.getBaseValue())},getBaseValue:function(){var t=this.min,i=this.max;return this.beginAtZero?0:t<0&&i<0?i:t>0&&i>0?t:0},_autoSkip:function(t){var i,e,o=this,a=o.isHorizontal(),n=o.options.ticks.minor,r=t.length,s=!1,l=n.maxTicksLimit,h=o._tickSize()*(r-1),f=a?o.width-(o.paddingLeft+o.paddingRight):o.height-(o.paddingTop+o.PaddingBottom),d=[];for(h>f&&(s=1+Math.floor(h/f)),r>l&&(s=Math.max(s,1+Math.floor(r/l))),i=0;i<r;i++)e=t[i],s>1&&i%s>0&&delete e.label,d.push(e);return d},_tickSize:function(){var t=this,i=t.isHorizontal(),e=t.options.ticks.minor,o=r.toRadians(t.labelRotation),a=Math.abs(Math.cos(o)),n=Math.abs(Math.sin(o)),s=e.autoSkipPadding||0,l=t.longestLabelWidth+s||0,h=r.options._parseFont(e),f=t._maxLabelLines*h.lineHeight+s||0;return i?f*a>l*n?l/a:f/n:f*n<l*a?f/a:l/n},_isVisible:function(){var t,i,e,o=this.chart,a=this.options.display;if("auto"!==a)return!!a;for(t=0,i=o.data.datasets.length;t<i;++t)if(o.isDatasetVisible(t)&&((e=o.getDatasetMeta(t)).xAxisID===this.id||e.yAxisID===this.id))return!0;return!1},draw:function(t){var i=this,e=i.options;if(i._isVisible()){var o,n,s,f=i.chart,d=i.ctx,g=a.global.defaultFontColor,c=e.ticks.minor,p=e.ticks.major||c,m=e.gridLines,u=e.scaleLabel,b=e.position,k=0!==i.labelRotation,x=c.mirror,T=i.isHorizontal(),v=r.options._parseFont,L=c.display&&c.autoSkip?i._autoSkip(i.getTicks()):i.getTicks(),D=l(c.fontColor,g),y=v(c),R=y.lineHeight,F=l(p.fontColor,g),M=v(p),B=c.padding,z=c.labelOffset,C=m.drawTicks?m.tickMarkLength:0,P=l(u.fontColor,g),w=v(u),W=r.options.toPadding(u.padding),S=r.toRadians(i.labelRotation),_=[],H=m.drawBorder?h(m.lineWidth,0,0):0,O=r._alignPixel;"top"===b?(o=O(f,i.bottom,H),n=i.bottom-C,s=o-H/2):"bottom"===b?(o=O(f,i.top,H),n=o+H/2,s=i.top+C):"left"===b?(o=O(f,i.right,H),n=i.right-C,s=o-H/2):(o=O(f,i.left,H),n=o+H/2,s=i.left+C);if(r.each(L,function(o,a){if(!r.isNullOrUndef(o.label)){var l,d,g,c,p,u,v,L,D,y,F,M,P,w,W,A,j=o.label;a===i.zeroLineIndex&&e.offset===m.offsetGridLines?(l=m.zeroLineWidth,d=m.zeroLineColor,g=m.zeroLineBorderDash||[],c=m.zeroLineBorderDashOffset||0):(l=h(m.lineWidth,a),d=h(m.color,a),g=m.borderDash||[],c=m.borderDashOffset||0);var V=r.isArray(j)?j.length:1,U=function(t,i,e){var o=t.getPixelForTick(i);return e&&(1===t.getTicks().length?o-=t.isHorizontal()?Math.max(o-t.left,t.right-o):Math.max(o-t.top,t.bottom-o):o-=0===i?(t.getPixelForTick(1)-o)/2:(o-t.getPixelForTick(i-1))/2),o}(i,a,m.offsetGridLines);if(T){var I=C+B;U<i.left-1e-7&&(d="rgba(0,0,0,0)"),p=v=D=F=O(f,U,l),u=n,L=s,P=i.getPixelForTick(a)+z,"top"===b?(y=O(f,t.top,H)+H/2,M=t.bottom,W=((k?1:.5)-V)*R,A=k?"left":"center",w=i.bottom-I):(y=t.top,M=O(f,t.bottom,H)-H/2,W=(k?0:.5)*R,A=k?"right":"center",w=i.top+I)}else{var N=(x?0:C)+B;U<i.top-1e-7&&(d="rgba(0,0,0,0)"),p=n,v=s,u=L=y=M=O(f,U,l),w=i.getPixelForTick(a)+z,W=(1-V)*R/2,"left"===b?(D=O(f,t.left,H)+H/2,F=t.right,A=x?"left":"right",P=i.right-N):(D=t.left,F=O(f,t.right,H)-H/2,A=x?"right":"left",P=i.left+N)}_.push({tx1:p,ty1:u,tx2:v,ty2:L,x1:D,y1:y,x2:F,y2:M,labelX:P,labelY:w,glWidth:l,glColor:d,glBorderDash:g,glBorderDashOffset:c,rotation:-1*S,label:j,major:o.major,textOffset:W,textAlign:A})}}),r.each(_,function(t){var i=t.glWidth,e=t.glColor;if(m.display&&i&&e&&(d.save(),d.lineWidth=i,d.strokeStyle=e,d.setLineDash&&(d.setLineDash(t.glBorderDash),d.lineDashOffset=t.glBorderDashOffset),d.beginPath(),m.drawTicks&&(d.moveTo(t.tx1,t.ty1),d.lineTo(t.tx2,t.ty2)),m.drawOnChartArea&&(d.moveTo(t.x1,t.y1),d.lineTo(t.x2,t.y2)),d.stroke(),d.restore()),c.display){d.save(),d.translate(t.labelX,t.labelY),d.rotate(t.rotation),d.font=t.major?M.string:y.string,d.fillStyle=t.major?F:D,d.textBaseline="middle",d.textAlign=t.textAlign;var o=t.label,a=t.textOffset;if(r.isArray(o))for(var n=0;n<o.length;++n)d.fillText(""+o[n],0,a),a+=R;else d.fillText(o,0,a);d.restore()}}),u.display){var A,j,V=0,U=w.lineHeight/2;if(T)A=i.left+(i.right-i.left)/2,j="bottom"===b?i.bottom-U-W.bottom:i.top+U+W.top;else{var I="left"===b;A=I?i.left+U+W.top:i.right-U-W.top,j=i.top+(i.bottom-i.top)/2,V=I?-.5*Math.PI:.5*Math.PI}d.save(),d.translate(A,j),d.rotate(V),d.textAlign="center",d.textBaseline="middle",d.fillStyle=P,d.font=w.string,d.fillText(u.labelString,0,0),d.restore()}if(H){var N,G,X,Y,Z=H,q=h(m.lineWidth,L.length-1,0);T?(N=O(f,i.left,Z)-Z/2,G=O(f,i.right,q)+q/2,X=Y=o):(X=O(f,i.top,Z)-Z/2,Y=O(f,i.bottom,q)+q/2,N=G=o),d.lineWidth=H,d.strokeStyle=h(m.color,0),d.beginPath(),d.moveTo(N,X),d.lineTo(G,Y),d.stroke()}}}}),g(module.exports)?module.exports:g(exports)?exports:void 0});
//# sourceMappingURL=../sourcemaps/core/core.scale.js.map
