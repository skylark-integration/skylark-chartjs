/**
 * skylark-chartjs - A version of chartjs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.2
 * @link https://github.com/skylark-integration/skylark-chartjs/
 * @license MIT
 */
define(["./core.animation","./core.animations","../controllers/index","./core.defaults","../helpers/index","./core.interaction","./core.layouts","../platforms/platform","./core.plugins","../core/core.scaleService","./core.tooltip"],function(t,e,a,n,i,o,s,r,l,c,d){"use strict";var exports={},module={exports:{}},u=t,f=e,p=a,h=n,v=i,y=o,g=s,m=r,D=l,b=c,x=d,w=v.valueOrDefault;function A(){return v.merge({},[].slice.call(arguments),{merger:function(t,e,a,n){if("xAxes"===t||"yAxes"===t){var i,o,s,r=a[t].length;for(e[t]||(e[t]=[]),i=0;i<r;++i)s=a[t][i],o=w(s.type,"xAxes"===t?"category":"linear"),i>=e[t].length&&e[t].push({}),!e[t][i].type||s.type&&s.type!==e[t][i].type?v.merge(e[t][i],[b.getScaleDefaults(o),s]):v.merge(e[t][i],s)}else v._merger(t,e,a,n)}})}function _(){return v.merge({},[].slice.call(arguments),{merger:function(t,e,a,n){var i=e[t]||{},o=a[t];"scales"===t?e[t]=A(i,o):"scale"===t?e[t]=v.merge(i,[b.getScaleDefaults(o.type),o]):v._merger(t,e,a,n)}})}function E(t){return"top"===t||"bottom"===t}h._set("global",{elements:{},events:["mousemove","mouseout","click","touchstart","touchmove"],hover:{onHover:null,mode:"nearest",intersect:!0,animationDuration:400},onClick:null,maintainAspectRatio:!0,responsive:!0,responsiveAnimationDuration:0});var S=function(t,e){return this.construct(t,e),this};function M(t){return"object"!=typeof t||Array.isArray(t)||!function(t){var e;for(e in t)return!1;return!0}(t)}return v.extend(S.prototype,{construct:function(t,e){var a=this;e=function(t){var e=(t=t||{}).data=t.data||{};return e.datasets=e.datasets||[],e.labels=e.labels||[],t.options=_(h.global,h[t.type],t.options||{}),t}(e);var n=m.acquireContext(t,e),i=n&&n.canvas,o=i&&i.height,s=i&&i.width;a.id=v.uid(),a.ctx=n,a.canvas=i,a.config=e,a.width=s,a.height=o,a.aspectRatio=o?s/o:null,a.options=e.options,a._bufferedRender=!1,a.chart=a,a.controller=a,S.instances[a.id]=a,Object.defineProperty(a,"data",{get:function(){return a.config.data},set:function(t){a.config.data=t}}),n&&i?(a.initialize(),a.update()):console.error("Failed to create chart: can't acquire context from the given item")},initialize:function(){var t=this;return D.notify(t,"beforeInit"),v.retinaScale(t,t.options.devicePixelRatio),t.bindEvents(),t.options.responsive&&t.resize(!0),t.ensureScalesHaveIDs(),t.buildOrUpdateScales(),t.initToolTip(),D.notify(t,"afterInit"),t},clear:function(){return v.canvas.clear(this),this},stop:function(){return f.cancelAnimation(this),this},resize:function(t){var e=this,a=e.options,n=e.canvas,i=a.maintainAspectRatio&&e.aspectRatio||null,o=Math.max(0,Math.floor(v.getMaximumWidth(n))),s=Math.max(0,Math.floor(i?o/i:v.getMaximumHeight(n)));if((e.width!==o||e.height!==s)&&(n.width=e.width=o,n.height=e.height=s,n.style.width=o+"px",n.style.height=s+"px",v.retinaScale(e,a.devicePixelRatio),!t)){var r={width:o,height:s};D.notify(e,"resize",[r]),a.onResize&&a.onResize(e,r),e.stop(),e.update({duration:a.responsiveAnimationDuration})}},ensureScalesHaveIDs:function(){var t=this.options,e=t.scales||{},a=t.scale;v.each(e.xAxes,function(t,e){t.id=t.id||"x-axis-"+e}),v.each(e.yAxes,function(t,e){t.id=t.id||"y-axis-"+e}),a&&(a.id=a.id||"scale")},buildOrUpdateScales:function(){var t=this,e=t.options,a=t.scales||{},n=[],i=Object.keys(a).reduce(function(t,e){return t[e]=!1,t},{});e.scales&&(n=n.concat((e.scales.xAxes||[]).map(function(t){return{options:t,dtype:"category",dposition:"bottom"}}),(e.scales.yAxes||[]).map(function(t){return{options:t,dtype:"linear",dposition:"left"}}))),e.scale&&n.push({options:e.scale,dtype:"radialLinear",isDefault:!0,dposition:"chartArea"}),v.each(n,function(e){var n=e.options,o=n.id,s=w(n.type,e.dtype);E(n.position)!==E(e.dposition)&&(n.position=e.dposition),i[o]=!0;var r=null;if(o in a&&a[o].type===s)(r=a[o]).options=n,r.ctx=t.ctx,r.chart=t;else{var l=b.getScaleConstructor(s);if(!l)return;r=new l({id:o,type:s,options:n,ctx:t.ctx,chart:t}),a[r.id]=r}r.mergeTicksOptions(),e.isDefault&&(t.scale=r)}),v.each(i,function(t,e){t||delete a[e]}),t.scales=a,b.addScalesToLayout(this)},buildOrUpdateControllers:function(){var t=this,e=[];return v.each(t.data.datasets,function(a,n){var i=t.getDatasetMeta(n),o=a.type||t.config.type;if(i.type&&i.type!==o&&(t.destroyDatasetMeta(n),i=t.getDatasetMeta(n)),i.type=o,i.controller)i.controller.updateIndex(n),i.controller.linkScales();else{var s=p[i.type];if(void 0===s)throw new Error('"'+i.type+'" is not a chart type.');i.controller=new s(t,n),e.push(i.controller)}},t),e},resetElements:function(){var t=this;v.each(t.data.datasets,function(e,a){t.getDatasetMeta(a).controller.reset()},t)},reset:function(){this.resetElements(),this.tooltip.initialize()},update:function(t){var e,a,n=this;if(t&&"object"==typeof t||(t={duration:t,lazy:arguments[1]}),a=(e=n).options,v.each(e.scales,function(t){g.removeBox(e,t)}),a=_(h.global,h[e.config.type],a),e.options=e.config.options=a,e.ensureScalesHaveIDs(),e.buildOrUpdateScales(),e.tooltip._options=a.tooltips,e.tooltip.initialize(),D._invalidate(n),!1!==D.notify(n,"beforeUpdate")){n.tooltip._data=n.data;var i=n.buildOrUpdateControllers();v.each(n.data.datasets,function(t,e){n.getDatasetMeta(e).controller.buildOrUpdateElements()},n),n.updateLayout(),n.options.animation&&n.options.animation.duration&&v.each(i,function(t){t.reset()}),n.updateDatasets(),n.tooltip.initialize(),n.lastActive=[],D.notify(n,"afterUpdate"),n._bufferedRender?n._bufferedRequest={duration:t.duration,easing:t.easing,lazy:t.lazy}:n.render(t)}},updateLayout:function(){!1!==D.notify(this,"beforeLayout")&&(g.update(this,this.width,this.height),D.notify(this,"afterScaleUpdate"),D.notify(this,"afterLayout"))},updateDatasets:function(){if(!1!==D.notify(this,"beforeDatasetsUpdate")){for(var t=0,e=this.data.datasets.length;t<e;++t)this.updateDataset(t);D.notify(this,"afterDatasetsUpdate")}},updateDataset:function(t){var e=this.getDatasetMeta(t),a={meta:e,index:t};!1!==D.notify(this,"beforeDatasetUpdate",[a])&&(e.controller.update(),D.notify(this,"afterDatasetUpdate",[a]))},render:function(t){var e=this;t&&"object"==typeof t||(t={duration:t,lazy:arguments[1]});var a=e.options.animation,n=w(t.duration,a&&a.duration),i=t.lazy;if(!1!==D.notify(e,"beforeRender")){var o=function(t){D.notify(e,"afterRender"),v.callback(a&&a.onComplete,[t],e)};if(a&&n){var s=new u({numSteps:n/16.66,easing:t.easing||a.easing,render:function(t,e){var a=v.easing.effects[e.easing],n=e.currentStep,i=n/e.numSteps;t.draw(a(i),i,n)},onAnimationProgress:a.onProgress,onAnimationComplete:o});f.addAnimation(e,s,n,i)}else e.draw(),o(new u({numSteps:0,chart:e}));return e}},draw:function(t){var e=this;e.clear(),v.isNullOrUndef(t)&&(t=1),e.transition(t),e.width<=0||e.height<=0||!1!==D.notify(e,"beforeDraw",[t])&&(v.each(e.boxes,function(t){t.draw(e.chartArea)},e),e.drawDatasets(t),e._drawTooltip(t),D.notify(e,"afterDraw",[t]))},transition:function(t){for(var e=0,a=(this.data.datasets||[]).length;e<a;++e)this.isDatasetVisible(e)&&this.getDatasetMeta(e).controller.transition(t);this.tooltip.transition(t)},drawDatasets:function(t){var e=this;if(!1!==D.notify(e,"beforeDatasetsDraw",[t])){for(var a=(e.data.datasets||[]).length-1;a>=0;--a)e.isDatasetVisible(a)&&e.drawDataset(a,t);D.notify(e,"afterDatasetsDraw",[t])}},drawDataset:function(t,e){var a=this.getDatasetMeta(t),n={meta:a,index:t,easingValue:e};!1!==D.notify(this,"beforeDatasetDraw",[n])&&(a.controller.draw(e),D.notify(this,"afterDatasetDraw",[n]))},_drawTooltip:function(t){var e=this.tooltip,a={tooltip:e,easingValue:t};!1!==D.notify(this,"beforeTooltipDraw",[a])&&(e.draw(),D.notify(this,"afterTooltipDraw",[a]))},getElementAtEvent:function(t){return y.modes.single(this,t)},getElementsAtEvent:function(t){return y.modes.label(this,t,{intersect:!0})},getElementsAtXAxis:function(t){return y.modes["x-axis"](this,t,{intersect:!0})},getElementsAtEventForMode:function(t,e,a){var n=y.modes[e];return"function"==typeof n?n(this,t,a):[]},getDatasetAtEvent:function(t){return y.modes.dataset(this,t,{intersect:!0})},getDatasetMeta:function(t){var e=this.data.datasets[t];e._meta||(e._meta={});var a=e._meta[this.id];return a||(a=e._meta[this.id]={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null}),a},getVisibleDatasetCount:function(){for(var t=0,e=0,a=this.data.datasets.length;e<a;++e)this.isDatasetVisible(e)&&t++;return t},isDatasetVisible:function(t){var e=this.getDatasetMeta(t);return"boolean"==typeof e.hidden?!e.hidden:!this.data.datasets[t].hidden},generateLegend:function(){return this.options.legendCallback(this)},destroyDatasetMeta:function(t){var e=this.id,a=this.data.datasets[t],n=a._meta&&a._meta[e];n&&(n.controller.destroy(),delete a._meta[e])},destroy:function(){var t,e,a=this,n=a.canvas;for(a.stop(),t=0,e=a.data.datasets.length;t<e;++t)a.destroyDatasetMeta(t);n&&(a.unbindEvents(),v.canvas.clear(a),m.releaseContext(a.ctx),a.canvas=null,a.ctx=null),D.notify(a,"destroy"),delete S.instances[a.id]},toBase64Image:function(){return this.canvas.toDataURL.apply(this.canvas,arguments)},initToolTip:function(){var t=this;t.tooltip=new x({_chart:t,_chartInstance:t,_data:t.data,_options:t.options.tooltips},t)},bindEvents:function(){var t=this,e=t._listeners={},a=function(){t.eventHandler.apply(t,arguments)};v.each(t.options.events,function(n){m.addEventListener(t,n,a),e[n]=a}),t.options.responsive&&(a=function(){t.resize()},m.addEventListener(t,"resize",a),e.resize=a)},unbindEvents:function(){var t=this,e=t._listeners;e&&(delete t._listeners,v.each(e,function(e,a){m.removeEventListener(t,a,e)}))},updateHoverStyle:function(t,e,a){var n,i,o,s=a?"setHoverStyle":"removeHoverStyle";for(i=0,o=t.length;i<o;++i)(n=t[i])&&this.getDatasetMeta(n._datasetIndex).controller[s](n)},eventHandler:function(t){var e=this,a=e.tooltip;if(!1!==D.notify(e,"beforeEvent",[t])){e._bufferedRender=!0,e._bufferedRequest=null;var n=e.handleEvent(t);a&&(n=a._start?a.handleEvent(t):n|a.handleEvent(t)),D.notify(e,"afterEvent",[t]);var i=e._bufferedRequest;return i?e.render(i):n&&!e.animating&&(e.stop(),e.render({duration:e.options.hover.animationDuration,lazy:!0})),e._bufferedRender=!1,e._bufferedRequest=null,e}},handleEvent:function(t){var e,a=this,n=a.options||{},i=n.hover;return a.lastActive=a.lastActive||[],"mouseout"===t.type?a.active=[]:a.active=a.getElementsAtEventForMode(t,i.mode,i),v.callback(n.onHover||n.hover.onHover,[t.native,a.active],a),"mouseup"!==t.type&&"click"!==t.type||n.onClick&&n.onClick.call(a,t.native,a.active),a.lastActive.length&&a.updateHoverStyle(a.lastActive,i.mode,!1),a.active.length&&i.mode&&a.updateHoverStyle(a.active,i.mode,!0),e=!v.arrayEquals(a.active,a.lastActive),a.lastActive=a.active,e}}),S.instances={},module.exports=S,S.Controller=S,S.types={},v.configMerge=_,v.scaleMerge=A,M(module.exports)?module.exports:M(exports)?exports:void 0});
//# sourceMappingURL=../sourcemaps/core/core.controller.js.map
