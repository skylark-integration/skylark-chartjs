/**
 * skylark-chartjs - A version of chartjs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.2
 * @link https://github.com/skylark-integration/skylark-chartjs/
 * @license MIT
 */
define(["../core/core.adapters","../core/core.defaults","../helpers/index","../core/core.scale"],function(t,e,i,a){"use strict";var exports={},module={exports:{}},n=t,r=e,o=i,s=a,l=o.valueOrDefault,u=Number.MIN_SAFE_INTEGER||-9007199254740991,f=Number.MAX_SAFE_INTEGER||9007199254740991,m={millisecond:{common:!0,size:1,steps:[1,2,5,10,20,50,100,250,500]},second:{common:!0,size:1e3,steps:[1,2,5,10,15,30]},minute:{common:!0,size:6e4,steps:[1,2,5,10,15,30]},hour:{common:!0,size:36e5,steps:[1,2,3,6,12]},day:{common:!0,size:864e5,steps:[1,2,5]},week:{common:!1,size:6048e5,steps:[1,2,3,4]},month:{common:!0,size:2628e6,steps:[1,2,3]},quarter:{common:!1,size:7884e6,steps:[1,2,3,4]},year:{common:!0,size:3154e7}},h=Object.keys(m);function p(t,e){return t-e}function c(t){var e,i,a,n={},r=[];for(e=0,i=t.length;e<i;++e)n[a=t[e]]||(n[a]=!0,r.push(a));return r}function d(t,e,i,a){var n=function(t,e,i){for(var a,n,r,o=0,s=t.length-1;o>=0&&o<=s;){if(n=t[(a=o+s>>1)-1]||null,r=t[a],!n)return{lo:null,hi:r};if(r[e]<i)o=a+1;else{if(!(n[e]>i))return{lo:n,hi:r};s=a-1}}return{lo:r,hi:null}}(t,e,i),r=n.lo?n.hi?n.lo:t[t.length-2]:t[0],o=n.lo?n.hi?n.hi:t[t.length-1]:t[1],s=o[e]-r[e],l=s?(i-r[e])/s:0,u=(o[a]-r[a])*l;return r[a]+u}function g(t,e){var i=t._adapter,a=t.options.time,n=a.parser,r=n||a.format,s=e;return"function"==typeof n&&(s=n(s)),o.isFinite(s)||(s="string"==typeof r?i.parse(s,r):i.parse(s)),null!==s?+s:(n||"function"!=typeof r||(s=r(e),o.isFinite(s)||(s=i.parse(s))),s)}function _(t,e){if(o.isNullOrUndef(e))return null;var i=t.options.time,a=g(t,t.getRightValue(e));return null===a?a:(i.round&&(a=+t._adapter.startOf(a,i.round)),a)}function b(t){for(var e=h.indexOf(t)+1,i=h.length;e<i;++e)if(m[h[e]].common)return h[e]}function v(t,e,i,a){var n,r=t._adapter,o=t.options,s=o.time,u=s.unit||function(t,e,i,a){var n,r,o,s=h.length;for(n=h.indexOf(t);n<s-1;++n)if(o=(r=m[h[n]]).steps?r.steps[r.steps.length-1]:f,r.common&&Math.ceil((i-e)/(o*r.size))<=a)return h[n];return h[s-1]}(s.minUnit,e,i,a),p=b(u),c=l(s.stepSize,s.unitStepSize),d="week"===u&&s.isoWeekday,g=o.ticks.major.enabled,_=m[u],v=e,x=i,k=[];for(c||(c=function(t,e,i,a){var n,r,o,s=e-t,l=m[i],u=l.size,f=l.steps;if(!f)return Math.ceil(s/(a*u));for(n=0,r=f.length;n<r&&(o=f[n],!(Math.ceil(s/(u*o))<=a));++n);return o}(e,i,u,a)),d&&(v=+r.startOf(v,"isoWeek",d),x=+r.startOf(x,"isoWeek",d)),v=+r.startOf(v,d?"day":u),(x=+r.startOf(x,d?"day":u))<i&&(x=+r.add(x,1,u)),n=v,g&&p&&!d&&!s.round&&(n=+r.startOf(n,p),n=+r.add(n,~~((v-n)/(_.size*c))*c,u));n<x;n=+r.add(n,c,u))k.push(+n);return k.push(+n),k}function x(t){return"object"!=typeof t||Array.isArray(t)||!function(t){var e;for(e in t)return!1;return!0}(t)}return module.exports=s.extend({initialize:function(){this.mergeTicksOptions(),s.prototype.initialize.call(this)},update:function(){var t=this.options,e=t.time||(t.time={}),i=this._adapter=new n._date(t.adapters.date);return e.format&&console.warn("options.time.format is deprecated and replaced by options.time.parser."),o.mergeIf(e.displayFormats,i.formats()),s.prototype.update.apply(this,arguments)},getRightValue:function(t){return t&&void 0!==t.t&&(t=t.t),s.prototype.getRightValue.call(this,t)},determineDataLimits:function(){var t,e,i,a,n,r,s=this,l=s.chart,m=s._adapter,h=s.options.time,d=h.unit||"day",g=f,b=u,v=[],x=[],k=[],y=l.data.labels||[];for(t=0,i=y.length;t<i;++t)k.push(_(s,y[t]));for(t=0,i=(l.data.datasets||[]).length;t<i;++t)if(l.isDatasetVisible(t))if(n=l.data.datasets[t].data,o.isObject(n[0]))for(x[t]=[],e=0,a=n.length;e<a;++e)r=_(s,n[e]),v.push(r),x[t][e]=r;else{for(e=0,a=k.length;e<a;++e)v.push(k[e]);x[t]=k.slice(0)}else x[t]=[];k.length&&(k=c(k).sort(p),g=Math.min(g,k[0]),b=Math.max(b,k[k.length-1])),v.length&&(v=c(v).sort(p),g=Math.min(g,v[0]),b=Math.max(b,v[v.length-1])),g=_(s,h.min)||g,b=_(s,h.max)||b,g=g===f?+m.startOf(Date.now(),d):g,b=b===u?+m.endOf(Date.now(),d)+1:b,s.min=Math.min(g,b),s.max=Math.max(g+1,b),s._horizontal=s.isHorizontal(),s._table=[],s._timestamps={data:v,datasets:x,labels:k}},buildTicks:function(){var t,e,i,a=this,n=a.min,r=a.max,o=a.options,s=o.time,l=[],u=[];switch(o.ticks.source){case"data":l=a._timestamps.data;break;case"labels":l=a._timestamps.labels;break;case"auto":default:l=v(a,n,r,a.getLabelCapacity(n))}for("ticks"===o.bounds&&l.length&&(n=l[0],r=l[l.length-1]),n=_(a,s.min)||n,r=_(a,s.max)||r,t=0,e=l.length;t<e;++t)(i=l[t])>=n&&i<=r&&u.push(i);return a.min=n,a.max=r,a._unit=s.unit||function(t,e,i,a,n){var r,o;for(r=h.length-1;r>=h.indexOf(i);r--)if(o=h[r],m[o].common&&t._adapter.diff(n,a,o)>=e.length)return o;return h[i?h.indexOf(i):0]}(a,u,s.minUnit,a.min,a.max),a._majorUnit=b(a._unit),a._table=function(t,e,i,a){if("linear"===a||!t.length)return[{time:e,pos:0},{time:i,pos:1}];var n,r,o,s,l,u=[],f=[e];for(n=0,r=t.length;n<r;++n)(s=t[n])>e&&s<i&&f.push(s);for(f.push(i),n=0,r=f.length;n<r;++n)l=f[n+1],o=f[n-1],s=f[n],void 0!==o&&void 0!==l&&Math.round((l+o)/2)===s||u.push({time:s,pos:n/(r-1)});return u}(a._timestamps.data,n,r,o.distribution),a._offsets=function(t,e,i,a,n){var r,o,s=0,l=0;return n.offset&&e.length&&(n.time.min||(r=d(t,"time",e[0],"pos"),s=1===e.length?1-r:(d(t,"time",e[1],"pos")-r)/2),n.time.max||(o=d(t,"time",e[e.length-1],"pos"),l=1===e.length?o:(o-d(t,"time",e[e.length-2],"pos"))/2)),{start:s,end:l}}(a._table,u,0,0,o),o.ticks.reverse&&u.reverse(),function(t,e,i){var a,n,r,o,s=[];for(a=0,n=e.length;a<n;++a)r=e[a],o=!!i&&r===+t._adapter.startOf(r,i),s.push({value:r,major:o});return s}(a,u,a._majorUnit)},getLabelForIndex:function(t,e){var i=this,a=i._adapter,n=i.chart.data,r=i.options.time,s=n.labels&&t<n.labels.length?n.labels[t]:"",l=n.datasets[e].data[t];return o.isObject(l)&&(s=i.getRightValue(l)),r.tooltipFormat?a.format(g(i,s),r.tooltipFormat):"string"==typeof s?s:a.format(g(i,s),r.displayFormats.datetime)},tickFormatFunction:function(t,e,i,a){var n=this._adapter,r=this.options,o=r.time.displayFormats,s=o[this._unit],u=this._majorUnit,f=o[u],m=+n.startOf(t,u),h=r.ticks.major,p=h.enabled&&u&&f&&t===m,c=n.format(t,a||(p?f:s)),d=p?h:r.ticks.minor,g=l(d.callback,d.userCallback);return g?g(c,e,i):c},convertTicksToLabels:function(t){var e,i,a=[];for(e=0,i=t.length;e<i;++e)a.push(this.tickFormatFunction(t[e].value,e,t));return a},getPixelForOffset:function(t){var e=this,i=e.options.ticks.reverse,a=e._horizontal?e.width:e.height,n=e._horizontal?i?e.right:e.left:i?e.bottom:e.top,r=d(e._table,"time",t,"pos"),o=a*(e._offsets.start+r)/(e._offsets.start+1+e._offsets.end);return i?n-o:n+o},getPixelForValue:function(t,e,i){var a=null;if(void 0!==e&&void 0!==i&&(a=this._timestamps.datasets[i][e]),null===a&&(a=_(this,t)),null!==a)return this.getPixelForOffset(a)},getPixelForTick:function(t){var e=this.getTicks();return t>=0&&t<e.length?this.getPixelForOffset(e[t].value):null},getValueForPixel:function(t){var e=this,i=e._horizontal?e.width:e.height,a=e._horizontal?e.left:e.top,n=(i?(t-a)/i:0)*(e._offsets.start+1+e._offsets.start)-e._offsets.end,r=d(e._table,"pos",n,"time");return e._adapter._create(r)},getLabelWidth:function(t){var e=this.options.ticks,i=this.ctx.measureText(t).width,a=o.toRadians(e.maxRotation),n=Math.cos(a),s=Math.sin(a);return i*n+l(e.fontSize,r.global.defaultFontSize)*s},getLabelCapacity:function(t){var e=this,i=e.options.time.displayFormats.millisecond,a=e.tickFormatFunction(t,0,[],i),n=e.getLabelWidth(a),r=e.isHorizontal()?e.width:e.height,o=Math.floor(r/n);return o>0?o:1}}),module.exports._defaults={position:"bottom",distribution:"linear",bounds:"data",adapters:{},time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{autoSkip:!1,source:"auto",major:{enabled:!1}}},x(module.exports)?module.exports:x(exports)?exports:void 0});
//# sourceMappingURL=../sourcemaps/scales/scale.time.js.map
