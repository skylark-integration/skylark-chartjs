/**
 * skylark-chartjs - A version of chartjs that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.2
 * @link https://github.com/skylark-integration/skylark-chartjs/
 * @license MIT
 */
define(["../core/core.defaults","../core/core.element","../helpers/index","../core/core.layouts"],function(e,t,i,n){"use strict";var exports={},module={exports:{}},o=e,a=t,l=i,r=n,d=l.noop,s=l.valueOrDefault;function h(e,t){return e.usePointStyle&&e.boxWidth>t?t:e.boxWidth}o._set("global",{legend:{display:!0,position:"top",fullWidth:!0,reverse:!1,weight:1e3,onClick:function(e,t){var i=t.datasetIndex,n=this.chart,o=n.getDatasetMeta(i);o.hidden=null===o.hidden?!n.data.datasets[i].hidden:null,n.update()},onHover:null,onLeave:null,labels:{boxWidth:40,padding:10,generateLabels:function(e){var t=e.data;return l.isArray(t.datasets)?t.datasets.map(function(t,i){return{text:t.label,fillStyle:l.isArray(t.backgroundColor)?t.backgroundColor[0]:t.backgroundColor,hidden:!e.isDatasetVisible(i),lineCap:t.borderCapStyle,lineDash:t.borderDash,lineDashOffset:t.borderDashOffset,lineJoin:t.borderJoinStyle,lineWidth:t.borderWidth,strokeStyle:t.borderColor,pointStyle:t.pointStyle,datasetIndex:i}},this):[]}}},legendCallback:function(e){var t=[];t.push('<ul class="'+e.id+'-legend">');for(var i=0;i<e.data.datasets.length;i++)t.push('<li><span style="background-color:'+e.data.datasets[i].backgroundColor+'"></span>'),e.data.datasets[i].label&&t.push(e.data.datasets[i].label),t.push("</li>");return t.push("</ul>"),t.join("")}});var f=a.extend({initialize:function(e){l.extend(this,e),this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1},beforeUpdate:d,update:function(e,t,i){var n=this;return n.beforeUpdate(),n.maxWidth=e,n.maxHeight=t,n.margins=i,n.beforeSetDimensions(),n.setDimensions(),n.afterSetDimensions(),n.beforeBuildLabels(),n.buildLabels(),n.afterBuildLabels(),n.beforeFit(),n.fit(),n.afterFit(),n.afterUpdate(),n.minSize},afterUpdate:d,beforeSetDimensions:d,setDimensions:function(){var e=this;e.isHorizontal()?(e.width=e.maxWidth,e.left=0,e.right=e.width):(e.height=e.maxHeight,e.top=0,e.bottom=e.height),e.paddingLeft=0,e.paddingTop=0,e.paddingRight=0,e.paddingBottom=0,e.minSize={width:0,height:0}},afterSetDimensions:d,beforeBuildLabels:d,buildLabels:function(){var e=this,t=e.options.labels||{},i=l.callback(t.generateLabels,[e.chart],e)||[];t.filter&&(i=i.filter(function(i){return t.filter(i,e.chart.data)})),e.options.reverse&&i.reverse(),e.legendItems=i},afterBuildLabels:d,beforeFit:d,fit:function(){var e=this,t=e.options,i=t.labels,n=t.display,o=e.ctx,a=l.options._parseFont(i),r=a.size,d=e.legendHitBoxes=[],s=e.minSize,f=e.isHorizontal();if(f?(s.width=e.maxWidth,s.height=n?10:0):(s.width=n?10:0,s.height=e.maxHeight),n)if(o.font=a.string,f){var p=e.lineWidths=[0],u=0;o.textAlign="left",o.textBaseline="top",l.each(e.legendItems,function(e,t){var n=h(i,r)+r/2+o.measureText(e.text).width;(0===t||p[p.length-1]+n+i.padding>s.width)&&(u+=r+i.padding,p[p.length-(t>0?0:1)]=i.padding),d[t]={left:0,top:0,width:n,height:r},p[p.length-1]+=n+i.padding}),s.height+=u}else{var g=i.padding,c=e.columnWidths=[],b=i.padding,v=0,m=0,x=r+g;l.each(e.legendItems,function(e,t){var n=h(i,r)+r/2+o.measureText(e.text).width;t>0&&m+x>s.height-g&&(b+=v+i.padding,c.push(v),v=0,m=0),v=Math.max(v,n),m+=x,d[t]={left:0,top:0,width:n,height:r}}),b+=v,c.push(v),s.width+=b}e.width=s.width,e.height=s.height},afterFit:d,isHorizontal:function(){return"top"===this.options.position||"bottom"===this.options.position},draw:function(){var e=this,t=e.options,i=t.labels,n=o.global,a=n.defaultColor,r=n.elements.line,d=e.width,f=e.lineWidths;if(t.display){var p,u=e.ctx,g=s(i.fontColor,n.defaultFontColor),c=l.options._parseFont(i),b=c.size;u.textAlign="left",u.textBaseline="middle",u.lineWidth=.5,u.strokeStyle=g,u.fillStyle=g,u.font=c.string;var v=h(i,b),m=e.legendHitBoxes,x=e.isHorizontal();p=x?{x:e.left+(d-f[0])/2+i.padding,y:e.top+i.padding,line:0}:{x:e.left+i.padding,y:e.top+i.padding,line:0};var y=b+i.padding;l.each(e.legendItems,function(n,o){var h=u.measureText(n.text).width,g=v+b/2+h,c=p.x,S=p.y;x?o>0&&c+g+i.padding>e.left+e.minSize.width&&(S=p.y+=y,p.line++,c=p.x=e.left+(d-f[p.line])/2+i.padding):o>0&&S+y>e.top+e.minSize.height&&(c=p.x=c+e.columnWidths[p.line]+i.padding,S=p.y=e.top+i.padding,p.line++),function(e,i,n){if(!(isNaN(v)||v<=0)){u.save();var o=s(n.lineWidth,r.borderWidth);if(u.fillStyle=s(n.fillStyle,a),u.lineCap=s(n.lineCap,r.borderCapStyle),u.lineDashOffset=s(n.lineDashOffset,r.borderDashOffset),u.lineJoin=s(n.lineJoin,r.borderJoinStyle),u.lineWidth=o,u.strokeStyle=s(n.strokeStyle,a),u.setLineDash&&u.setLineDash(s(n.lineDash,r.borderDash)),t.labels&&t.labels.usePointStyle){var d=v*Math.SQRT2/2,h=e+v/2,f=i+b/2;l.canvas.drawPoint(u,n.pointStyle,d,h,f)}else 0!==o&&u.strokeRect(e,i,v,b),u.fillRect(e,i,v,b);u.restore()}}(c,S,n),m[o].left=c,m[o].top=S,function(e,t,i,n){var o=b/2,a=v+o+e,l=t+o;u.fillText(i.text,a,l),i.hidden&&(u.beginPath(),u.lineWidth=2,u.moveTo(a,l),u.lineTo(a+n,l),u.stroke())}(c,S,n,h),x?p.x+=g+i.padding:p.y+=y})}},_getLegendItemAt:function(e,t){var i,n,o,a=this;if(e>=a.left&&e<=a.right&&t>=a.top&&t<=a.bottom)for(o=a.legendHitBoxes,i=0;i<o.length;++i)if(e>=(n=o[i]).left&&e<=n.left+n.width&&t>=n.top&&t<=n.top+n.height)return a.legendItems[i];return null},handleEvent:function(e){var t,i=this,n=i.options,o="mouseup"===e.type?"click":e.type;if("mousemove"===o){if(!n.onHover&&!n.onLeave)return}else{if("click"!==o)return;if(!n.onClick)return}t=i._getLegendItemAt(e.x,e.y),"click"===o?t&&n.onClick&&n.onClick.call(i,e.native,t):(n.onLeave&&t!==i._hoveredItem&&(i._hoveredItem&&n.onLeave.call(i,e.native,i._hoveredItem),i._hoveredItem=t),n.onHover&&t&&n.onHover.call(i,e.native,t))}});function p(e,t){var i=new f({ctx:e.ctx,options:t,chart:e});r.configure(e,i,t),r.addBox(e,i),e.legend=i}function u(e){return"object"!=typeof e||Array.isArray(e)||!function(e){var t;for(t in e)return!1;return!0}(e)}return module.exports={id:"legend",_element:f,beforeInit:function(e){var t=e.options.legend;t&&p(e,t)},beforeUpdate:function(e){var t=e.options.legend,i=e.legend;t?(l.mergeIf(t,o.global.legend),i?(r.configure(e,i,t),i.options=t):p(e,t)):i&&(r.removeBox(e,i),delete e.legend)},afterEvent:function(e,t){var i=e.legend;i&&i.handleEvent(t)}},u(module.exports)?module.exports:u(exports)?exports:void 0});
//# sourceMappingURL=../sourcemaps/plugins/plugin.legend.js.map
